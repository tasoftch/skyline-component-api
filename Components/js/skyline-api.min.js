!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["skyline-api"]=e():t["skyline-api"]=e()}(self,(()=>(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const e=(()=>{if(window.jQuery)return window.jQuery;throw new Error("Skyline component API requires jQuery")})();let s=(t,e)=>{t.length>0&&t.forEach((t=>{t.api&&t.api(e)}))};const a={xhr:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(t){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return console.error("This browser is not AJAX enabled."),null}}},withCredentials:!0,authenticationHandler:void 0},r={"application/json":t=>{let e=JSON.parse(t.responseText);if(e.success)return e;throw e.errors[0]},"text/html":t=>{let s=t.responseText;return"## SKY_AUTOLOAD ##"===s.substring(0,18)&&(s=s.substring(18),e(document.body).append(e(s))),s},"application/octet-stream":t=>new Blob(t.response),default:t=>t.responseText};class i{constructor(t,e){this._settings=Object.assign({},a),this._xhr=t,t.withCredentials=this._settings.withCredentials,this._target=e,this._successCallbacks=[],this._failCallbacks=[],this._uploadCallbacks=[],this._downloadCallbacks=[],this._doneCallbacks=[],this._buttons=[],this._authCallback=this._settings.authenticationHandler,this._setupEventHandlers(t),this.responseHandlers=r,this._data=!1}_trigger(t,...e){void 0!==t&&t.length>0&&t.forEach((t=>{t(...e)}))}_progress(t,e){var s=0,a=t.loaded||t.position,r=t.total;t.lengthComputable&&(s=Math.ceil(a/r*100)),this._trigger(e,s,a,r,t.lengthComputable)}_auth(){return"function"==typeof this._authCallback&&(this._authCallback({target:this._target,formData:this._data,cancel:t=>{this._trigger(this._failCallbacks,t),this.afterHandler()},retry:(t,e)=>{const s=this._settings.xhr();if(!s)throw new Error("Could not create api call. No XHR instance could be created.");const a=new i(s,t&&t.length?t:this._target);return a._successCallbacks=this._successCallbacks,a._failCallbacks=this._failCallbacks,a._uploadCallbacks=this._uploadCallbacks,a._downloadCallbacks=this._downloadCallbacks,a._doneCallbacks=this._doneCallbacks,a._buttons=this._buttons,a.responseHandlers=this.responseHandlers,"P"===this._m?(s.open("POST",a._target),a.send(e||this._data)):(s.open("GET",a._target),a.send()),a}}),!0)}_load(){let t=this._xhr.getResponseHeader("content-type");if(401!==this._xhr.status||"function"!=typeof this._authCallback||!this._auth()){try{for(let e in this.responseHandlers)if("default"===e||t.substr(0,e.length).toLowerCase()===e.toLowerCase()){let t=this.responseHandlers[e];if("function"==typeof t){this._trigger(this._successCallbacks,t.call(this,this._xhr));break}throw new Error("Could not parse response.")}}catch(t){if(void 0!==t.code&&401===t.code&&this._auth())return;this._trigger(this._failCallbacks,t)}this.afterHandler()}}_setupEventHandlers(t){t.upload.addEventListener("progress",(t=>{this._progress(t,this._uploadCallbacks)})),t.addEventListener("progress",(t=>{this._progress(t,this._downloadCallbacks)})),t.addEventListener("load",this._load.bind(this)),t.addEventListener("error",(t=>{this._trigger(this._failCallbacks,t)})),t.addEventListener("abort",(t=>{this._trigger(this._failCallbacks,t)}))}beforeHandler(){s(this._buttons,"start")}afterHandler(){s(this._buttons,"stop"),this._trigger(this._doneCallbacks)}send(t){window.setTimeout((()=>{this.beforeHandler();try{t?(this._data=t,this._xhr.send(t)):this._xhr.send()}catch(t){this.afterHandler(),this._trigger(this._failCallbacks,t)}}),1)}button(t){return"string"==typeof t&&e&&(t=e(t)),t&&this._buttons.push(t),this}success(t){return t&&"function"==typeof t&&this._successCallbacks.push(t),this}error(t){return t&&"function"==typeof t&&this._failCallbacks.push(t),this}upload(t){return t&&"function"==typeof t&&this._uploadCallbacks.push(t),this}download(t){return t&&"function"==typeof t&&this._downloadCallbacks.push(t),this}done(t){return t&&"function"==typeof t&&this._doneCallbacks.push(t),this}authenticator(t){this._authCallback=t}get target(){return this._target}get settings(){return this._settings}get data(){return this._data}}const n={responseHandlers:r,setup:a,makeTarget:function(t){return/^https?/i.test(t)?t:this.HOST_PREFIX?this.HOST_PREFIX+t:t},get:function(t){let e,s=this.setup.xhr();if(!s)throw new Error("Could not create api call. No XHR instance could be creted.");var a=new i(s,e=this.makeTarget(t));return a._m="G",s.open("GET",e),a.send(),a},post:function(t,e){if(!(e instanceof FormData)){var s=new FormData;for(let t in e)e.hasOwnProperty(t)&&s.append(t,e[t]);e=s}this.CSRF_TOKEN_NAME&&this.CSRF_TOKEN&&e.append(this.CSRF_TOKEN_NAME,this.CSRF_TOKEN);let a,r=this.setup.xhr();if(!r)throw new Error("Could not create api call. No XHR instance could be creted.");var n=new i(r,a=this.makeTarget(t));return n._m="P",r.open("POST",a),n.send(e),n}};var o;return o=window.jQuery,window.Skyline.API=n,o.fn.api=function(t){"start"===t&&this.addClass("api-loading"),"stop"===t&&this.removeClass("api-loading")},t})()));