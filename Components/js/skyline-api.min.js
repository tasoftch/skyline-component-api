!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["skyline-api"]=e():t["skyline-api"]=e()}(window,(function(){return function(t){var e={};function s(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);var r=(()=>{if(window.jQuery)return window.jQuery;throw new Error("Skyline component API requires jQuery")})();let n=(t,e)=>{t.length>0&&t.forEach(t=>{t.api&&t.api(e)})};const a={xhr:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(t){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return console.error("This browser is not AJAX enabled."),null}}},withCredentials:!0,authenticationHandler:void 0},i={"application/json":t=>{let e=JSON.parse(t.responseText);if(e.success)return e;throw e.errors[0]},"text/html":t=>r(t.responseText),"application/octet-stream":t=>new Blob(t.response),default:t=>t.responseText};class o{constructor(t,e){this._settings=Object.assign({},a),this._xhr=t,t.withCredentials=!!this._settings.withCredentials,this._target=e,this._successCallbacks=[],this._failCallbacks=[],this._uploadCallbacks=[],this._downloadCallbacks=[],this._doneCallbacks=[],this._buttons=[],this._setupEventHandlers(t),this.responseHandlers=i,this._data=!1}_trigger(t,...e){void 0!==t&&t.length>0&&t.forEach(t=>{t(...e)})}_progress(t,e){var s=0,r=t.loaded||t.position,n=t.total;t.lengthComputable&&(s=Math.ceil(r/n*100)),this._trigger(e,s,r,n,t.lengthComputable)}_load(){let t=this._xhr.getResponseHeader("content-type");if(401!==this._xhr.status||"function"!=typeof this._settings.authenticationHandler){try{for(let e in this.responseHandlers)if("default"===e||t.substr(0,e.length).toLowerCase()===e.toLowerCase()){let t=this.responseHandlers[e];if("function"==typeof t){this._trigger(this._successCallbacks,t.call(this,this._xhr));break}throw new Error("Could not parse response.")}}catch(t){this._trigger(this._failCallbacks,t)}this.afterHandler()}else this._settings.authenticationHandler({target:this.this._target,formData:this._data,cancel:t=>{this._trigger(this._failCallbacks,t),this.afterHandler()},retry:(t,e)=>{const s=this._settings.xhr();if(!s)throw new Error("Could not create api call. No XHR instance could be created.");const r=new o(s,t&&t.length?t:this._target);return r._successCallbacks=this._successCallbacks,r._failCallbacks=this._failCallbacks,r._uploadCallbacks=this._uploadCallbacks,r._downloadCallbacks=this._downloadCallbacks,r._doneCallbacks=this._doneCallbacks,r._buttons=this._buttons,r.responseHandlers=this.responseHandlers,"P"===this._m?(s.open("POST",r._target),r.send(e||this._data)):(s.open("GET",r._target),r.send()),r}})}_setupEventHandlers(t){t.upload.addEventListener("progress",t=>{this._progress(t,this._uploadCallbacks)}),t.addEventListener("progress",t=>{this._progress(t,this._downloadCallbacks)}),t.addEventListener("load",this._load.bind(this)),t.addEventListener("error",t=>{this._trigger(this._failCallbacks,t)}),t.addEventListener("abort",t=>{this._trigger(this._failCallbacks,t)})}beforeHandler(){n(this._buttons,"start")}afterHandler(){n(this._buttons,"stop"),this._trigger(this._doneCallbacks)}send(t){window.setTimeout(()=>{this.beforeHandler();try{t?(this._data=t,this._xhr.send(t)):this._xhr.send()}catch(t){this.afterHandler(),this._trigger(this._failCallbacks,t)}},1)}button(t){return"string"==typeof t&&r&&(t=r(t)),t&&this._buttons.push(t),this}success(t){return t&&"function"==typeof t&&this._successCallbacks.push(t),this}error(t){return t&&"function"==typeof t&&this._failCallbacks.push(t),this}upload(t){return t&&"function"==typeof t&&this._uploadCallbacks.push(t),this}download(t){return t&&"function"==typeof t&&this._downloadCallbacks.push(t),this}done(t){return t&&"function"==typeof t&&this._doneCallbacks.push(t),this}get target(){return this._target}get settings(){return this._settings}get data(){return this._data}}var l,h={responseHandlers:i,setup:a,makeTarget:function(t){return/^https?/i.test(t)?t:this.HOST_PREFIX?this.HOST_PREFIX+t:t},get:function(t){let e,s=this.setup.xhr();if(!s)throw new Error("Could not create api call. No XHR instance could be creted.");var r=new o(s,e=this.makeTarget(t));return r._m="G",s.open("GET",e),r.send(),r},post:function(t,e){if(!(e instanceof FormData)){var s=new FormData;for(let t in e)e.hasOwnProperty(t)&&s.append(t,e[t]);e=s}this.CSRF_TOKEN_NAME&&this.CSRF_TOKEN&&e.append(this.CSRF_TOKEN_NAME,this.CSRF_TOKEN);let r,n=this.setup.xhr();if(!n)throw new Error("Could not create api call. No XHR instance could be creted.");var a=new o(n,r=this.makeTarget(t));return a._m="P",n.open("POST",r),a.send(e),a}};l=window.jQuery,window.Skyline.API=h,l.fn.api=function(t){"start"===t&&this.addClass("api-loading"),"stop"===t&&this.removeClass("api-loading")}}])}));